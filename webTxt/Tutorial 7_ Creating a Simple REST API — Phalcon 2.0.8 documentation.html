<!DOCTYPE html>
<!-- saved from url=(0066)https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    
    
    <title>Tutorial 7: Creating a Simple REST API — Phalcon 2.0.8 documentation</title>
    <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework">
    <link rel="stylesheet" type="text/css" href="./Tutorial 7_ Creating a Simple REST API — Phalcon 2.0.8 documentation_files/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./Tutorial 7_ Creating a Simple REST API — Phalcon 2.0.8 documentation_files/phalcon.min.css">
    <link href="./Tutorial 7_ Creating a Simple REST API — Phalcon 2.0.8 documentation_files/css" rel="stylesheet" type="text/css">
    <link href="./Tutorial 7_ Creating a Simple REST API — Phalcon 2.0.8 documentation_files/css(1)" rel="stylesheet" type="text/css">
    <!--
    EUROPE <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=latin-ext' rel='stylesheet' type='text/css'>
    GREEK <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=greek-ext' rel='stylesheet' type='text/css'>
    RUSSIA <link href='//fonts.googleapis.com/css?family=Open+Sans:700,400&subset=cyrillic-ext,latin' rel='stylesheet' type='text/css'>
    -->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="./Tutorial 7_ Creating a Simple REST API — Phalcon 2.0.8 documentation_files/pygments.css" type="text/css">
    <link rel="stylesheet" href="./Tutorial 7_ Creating a Simple REST API — Phalcon 2.0.8 documentation_files/docs.css" type="text/css">
    <script type="text/javascript">var DOCUMENTATION_OPTIONS={URL_ROOT:'../',VERSION:'2.0.8',COLLAPSE_MODINDEX:false,FILE_SUFFIX:'.html',HAS_SOURCE:true};</script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script type="text/javascript" src="./Tutorial 7_ Creating a Simple REST API — Phalcon 2.0.8 documentation_files/docs.js"></script>
    <link rel="shortcut icon" href="https://docs.phalconphp.com/en/latest/_static/favicon.ico">
    <link rel="top" title="Phalcon 2.0.8 documentation" href="https://docs.phalconphp.com/en/latest/index.html">
    <link rel="next" title="List of examples" href="https://docs.phalconphp.com/en/latest/reference/samples.html">
    <link rel="prev" title="Tutorial 6: Vökuró" href="https://docs.phalconphp.com/en/latest/reference/tutorial-vokuro.html"> 
  <script id="_carbonads_projs" type="text/javascript" src="./Tutorial 7_ Creating a Simple REST API — Phalcon 2.0.8 documentation_files/C6AILKT.json"></script><script type="text/javascript" src="./Tutorial 7_ Creating a Simple REST API — Phalcon 2.0.8 documentation_files/8"></script></head>
  <body>

<header class="page-header">
    <nav class="navbar" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-container">
                    <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
                </button>
                <a class="navbar-brand phalcon-logo" href="https://docs.phalconphp.com/"><span itemprop="name" class="sr-only">Phalcon PHP</span></a>
            </div>

            <div class="collapse navbar-collapse navbar-right" id="main-menu-container">
                <ul class="nav navbar-nav main-menu">
                  <li class="first"><a href="http://phalconphp.com/en/download" class="header-nav-link">Download</a></li>
                  <li><a href="https://docs.phalconphp.com/en/latest/index.html" class="header-nav-link" target="_blank">Documentation</a></li>
                  <li><a href="https://forum.phalconphp.com/" class="header-nav-link" target="_blank">Forum</a></li>
                  <li><a href="https://blog.phalconphp.com/" class="header-nav-link" target="_blank">Blog</a></li>
                  <li><a href="https://phalconist.com/" class="header-nav-link" target="_blank">Resources</a></li>
                  <li><a href="https://phalconphp.com/en/about">About</a></li>
                  <li><div align="right">
                      <iframe src="./Tutorial 7_ Creating a Simple REST API — Phalcon 2.0.8 documentation_files/github-btn.html" allowtransparency="true" frameborder="0" scrolling="0" width="152px" height="30px"></iframe>
                    </div></li>
                </ul>
            </div>
        </div>
    </nav>
  </header>

<div class="heading">
    <div class="container">
        <div class="row">
            <h2>Documentation</h2>
        </div>
    </div>
</div>
    <div class="related">
      <ul>
        <li class="right">
          <a href="https://docs.phalconphp.com/en/latest/genindex.html" title="General Index" accesskey="I">index</a></li>
        <li class="right">
          <a href="https://docs.phalconphp.com/en/latest/reference/samples.html" title="List of examples" accesskey="N">next</a> |</li>
        <li class="right">
          <a href="https://docs.phalconphp.com/en/latest/reference/tutorial-vokuro.html" title="Tutorial 6: Vökuró" accesskey="P">previous</a> |</li>
        <li><a href="http://phalconphp.com/">Home</a> »</li>
        <li><a href="https://docs.phalconphp.com/en/latest/index.html">Phalcon 2.0.8 documentation</a> »</li> 
      </ul>
    </div>  

      <table width="100%" align="center" cellpadding="0" cellspacing="0">
        <tbody><tr>
      <td class="primary-box" width="25%" valign="top">
            <div>
            <div id="searchbox" style="">
                <!--<form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="search" name="q" size="25" placeholder="Search">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:">
                </form>-->
                <div style="width:200px;padding:10px">
                  <gcse:searchbox-only></gcse:searchbox-only>
                </div>
            </div>
            </div>
            <div style="padding:5px;padding-left:10px">
              <div id="carbonads-container">
                <div class="carbonad"><div id="azcarbon"></div>
                <script async="" type="text/javascript" src="./Tutorial 7_ Creating a Simple REST API — Phalcon 2.0.8 documentation_files/carbon.js" id="_carbonads_js"></script><div id="carbonads"><span><span class="carbon-wrap"><a href="http://carbonads.com/" class="carbon-img" target="_blank"><img src="./Tutorial 7_ Creating a Simple REST API — Phalcon 2.0.8 documentation_files/15119" alt="" border="0" height="100" width="130" style="max-width:130px;"></a><a href="http://carbonads.com/" class="carbon-text" target="_blank">Carbon Ads - a circle you want to be part of. Grab a spot.</a></span><a href="http://carbonads.net/" class="carbon-poweredby" target="_blank">ads via Carbon</a></span></div>
                </div></div>
            </div>
            <h3><a href="https://docs.phalconphp.com/en/latest/index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#">Tutorial 7: Creating a Simple REST API</a><ul>
<li><a class="reference internal" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#defining-the-api">Defining the API</a></li>
<li><a class="reference internal" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#creating-the-application">Creating the Application</a></li>
<li><a class="reference internal" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#creating-a-model">Creating a Model</a></li>
<li><a class="reference internal" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#retrieving-data">Retrieving Data</a></li>
<li><a class="reference internal" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#inserting-data">Inserting Data</a></li>
<li><a class="reference internal" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#updating-data">Updating Data</a></li>
<li><a class="reference internal" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#deleting-data">Deleting Data</a></li>
<li><a class="reference internal" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#testing-our-application">Testing our Application</a></li>
<li><a class="reference internal" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="https://docs.phalconphp.com/en/latest/reference/tutorial-vokuro.html" title="previous chapter">&lt; Tutorial 6: Vökuró</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="https://docs.phalconphp.com/en/latest/reference/samples.html" title="next chapter">List of examples &gt;</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="https://docs.phalconphp.com/en/latest/_sources/reference/tutorial-rest.txt" rel="nofollow">Show Source</a></li>
            </ul>
        </td>
          <td class="second-box" valign="top">
            <div class="document">
                <div class="documentwrapper">
                  <div class="bodywrapper">
                    <div class="body">
                      
  <div class="section" id="tutorial-7-creating-a-simple-rest-api">
<h1>Tutorial 7: Creating a Simple REST API<a class="headerlink" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#tutorial-7-creating-a-simple-rest-api" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we will explain how to create a simple application that provides a <a class="reference external" href="http://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a> API using the
different HTTP methods:</p>
<ul class="simple">
<li>GET to retrieve and search data</li>
<li>POST to add data</li>
<li>PUT to update data</li>
<li>DELETE to delete data</li>
</ul>
<div class="section" id="defining-the-api">
<h2>Defining the API<a class="headerlink" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#defining-the-api" title="Permalink to this headline">¶</a></h2>
<p>The API consists of the following methods:</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%">
<col width="30%">
<col width="62%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">URL</th>
<th class="head">Action</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>GET</td>
<td>/api/robots</td>
<td>Retrieves all robots</td>
</tr>
<tr class="row-odd"><td>GET</td>
<td>/api/robots/search/Astro</td>
<td>Searches for robots with ‘Astro’ in their name</td>
</tr>
<tr class="row-even"><td>GET</td>
<td>/api/robots/2</td>
<td>Retrieves robots based on primary key</td>
</tr>
<tr class="row-odd"><td>POST</td>
<td>/api/robots</td>
<td>Adds a new robot</td>
</tr>
<tr class="row-even"><td>PUT</td>
<td>/api/robots/2</td>
<td>Updates robots based on primary key</td>
</tr>
<tr class="row-odd"><td>DELETE</td>
<td>/api/robots/2</td>
<td>Deletes robots based on primary key</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="creating-the-application">
<h2>Creating the Application<a class="headerlink" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#creating-the-application" title="Permalink to this headline">¶</a></h2>
<p>As the application is so simple, we will not implement any full MVC environment to develop it. In this case,
we will use a <a class="reference internal" href="https://docs.phalconphp.com/en/latest/reference/micro.html"><em>micro application</em></a> to meet our goal.</p>
<p>The following file structure is more than enough:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">my-rest-api/</span>
<span class="x">    models/</span>
<span class="x">        Robots.php</span>
<span class="x">    index.php</span>
<span class="x">    .htaccess</span>
</pre></div>
</div>
<p>First, we need an .htaccess file that contains all the rules to rewrite the URIs to the index.php file,
that is our application:</p>
<div class="highlight-apacheconf"><div class="highlight"><pre><span class="nt">&lt;IfModule</span> <span class="s">mod_rewrite.c</span><span class="nt">&gt;</span>
    <span class="nb">RewriteEngine</span> <span class="k">On</span>
    <span class="nb">RewriteCond</span> %{REQUEST_FILENAME} !-f
    <span class="nb">RewriteRule</span> ^((?s).*)$ index.php?_url=/$1 [QSA,L]
<span class="nt">&lt;/IfModule&gt;</span>
</pre></div>
</div>
<p>Then, in the index.php file we create the following:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Mvc\Micro</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Micro</span><span class="p">();</span>

<span class="c1">// Define the routes here</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">();</span>
</pre></div>
</div>
<p>Now we will create the routes as we defined above:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Mvc\Micro</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Micro</span><span class="p">();</span>

<span class="c1">// Retrieves all robots</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'/api/robots'</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>

<span class="p">});</span>

<span class="c1">// Searches for robots with $name in their name</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'/api/robots/search/{name}'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>

<span class="p">});</span>

<span class="c1">// Retrieves robots based on primary key</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'/api/robots/{id:[0-9]+}'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>

<span class="p">});</span>

<span class="c1">// Adds a new robot</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">'/api/robots'</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>

<span class="p">});</span>

<span class="c1">// Updates robots based on primary key</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">'/api/robots/{id:[0-9]+}'</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>

<span class="p">});</span>

<span class="c1">// Deletes robots based on primary key</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">'/api/robots/{id:[0-9]+}'</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>

<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">();</span>
</pre></div>
</div>
<p>Each route is defined with a method with the same name as the HTTP method, as first parameter we pass a route pattern,
followed by a handler. In this case, the handler is an anonymous function. The following route: ‘/api/robots/{id:[0-9]+}’,
by example, explicitly sets that the “id” parameter must have a numeric format.</p>
<p>When a defined route matches the requested URI then the application executes the corresponding handler.</p>
</div>
<div class="section" id="creating-a-model">
<h2>Creating a Model<a class="headerlink" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#creating-a-model" title="Permalink to this headline">¶</a></h2>
<p>Our API provides information about ‘robots’, these data are stored in a database. The following model allows us to
access that table in an object-oriented way. We have implemented some business rules using built-in validators
and simple validations. Doing this will give us the peace of mind that saved data meet the requirements of our
application:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Mvc\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Mvc\Model\Message</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Mvc\Model\Validator\Uniqueness</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Mvc\Model\Validator\InclusionIn</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Robots</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validation</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Type must be: droid, mechanical or virtual</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span>
            <span class="k">new</span> <span class="nx">InclusionIn</span><span class="p">(</span>
                <span class="k">array</span><span class="p">(</span>
                    <span class="s2">"field"</span>  <span class="o">=&gt;</span> <span class="s2">"type"</span><span class="p">,</span>
                    <span class="s2">"domain"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s2">"droid"</span><span class="p">,</span>
                        <span class="s2">"mechanical"</span><span class="p">,</span>
                        <span class="s2">"virtual"</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>

        <span class="c1">// Robot name must be unique</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span>
            <span class="k">new</span> <span class="nx">Uniqueness</span><span class="p">(</span>
                <span class="k">array</span><span class="p">(</span>
                    <span class="s2">"field"</span>   <span class="o">=&gt;</span> <span class="s2">"name"</span><span class="p">,</span>
                    <span class="s2">"message"</span> <span class="o">=&gt;</span> <span class="s2">"The robot name must be unique"</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>

        <span class="c1">// Year cannot be less than zero</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">year</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">appendMessage</span><span class="p">(</span><span class="k">new</span> <span class="nx">Message</span><span class="p">(</span><span class="s2">"The year cannot be less than zero"</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="c1">// Check if any messages have been produced</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validationHasFailed</span><span class="p">()</span> <span class="o">==</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now, we must set up a connection to be used by this model and load it within our app:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Loader</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Mvc\Micro</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\DI\FactoryDefault</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Phalcon\Db\Adapter\Pdo\Mysql</span> <span class="k">as</span> <span class="nx">PdoMysql</span><span class="p">;</span>

<span class="c1">// Use Loader() to autoload our model</span>
<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Loader</span><span class="p">();</span>

<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">registerDirs</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">'/models/'</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>

<span class="nv">$di</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FactoryDefault</span><span class="p">();</span>

<span class="c1">// Set up the database service</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'db'</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">PdoMysql</span><span class="p">(</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s2">"host"</span>     <span class="o">=&gt;</span> <span class="s2">"localhost"</span><span class="p">,</span>
            <span class="s2">"username"</span> <span class="o">=&gt;</span> <span class="s2">"asimov"</span><span class="p">,</span>
            <span class="s2">"password"</span> <span class="o">=&gt;</span> <span class="s2">"zeroth"</span><span class="p">,</span>
            <span class="s2">"dbname"</span>   <span class="o">=&gt;</span> <span class="s2">"robotics"</span>
        <span class="p">)</span>
    <span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Create and bind the DI to the application</span>
<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Micro</span><span class="p">(</span><span class="nv">$di</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="retrieving-data">
<h2>Retrieving Data<a class="headerlink" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#retrieving-data" title="Permalink to this headline">¶</a></h2>
<p>The first “handler” that we will implement is which by method GET returns all available robots. Let’s use PHQL to
perform this simple query returning the results as JSON:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Retrieves all robots</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'/api/robots'</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>

    <span class="nv">$phql</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Robots ORDER BY name"</span><span class="p">;</span>
    <span class="nv">$robots</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">modelsManager</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="nv">$phql</span><span class="p">);</span>

    <span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$robots</span> <span class="k">as</span> <span class="nv">$robot</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$data</span><span class="p">[]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'id'</span>   <span class="o">=&gt;</span> <span class="nv">$robot</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$robot</span><span class="o">-&gt;</span><span class="na">name</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p><a class="reference internal" href="https://docs.phalconphp.com/en/latest/reference/phql.html"><em>PHQL</em></a>, allow us to write queries using a high-level, object-oriented SQL dialect that internally
translates to the right SQL statements depending on the database system we are using. The clause “use” in the
anonymous function allows us to pass some variables from the global to local scope easily.</p>
<p>The searching by name handler would look like:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Searches for robots with $name in their name</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'/api/robots/search/{name}'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>

    <span class="nv">$phql</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Robots WHERE name LIKE :name: ORDER BY name"</span><span class="p">;</span>
    <span class="nv">$robots</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">modelsManager</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span>
        <span class="nv">$phql</span><span class="p">,</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'%'</span> <span class="o">.</span> <span class="nv">$name</span> <span class="o">.</span> <span class="s1">'%'</span>
        <span class="p">)</span>
    <span class="p">);</span>

    <span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$robots</span> <span class="k">as</span> <span class="nv">$robot</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$data</span><span class="p">[]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'id'</span>   <span class="o">=&gt;</span> <span class="nv">$robot</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$robot</span><span class="o">-&gt;</span><span class="na">name</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Searching by the field “id” it’s quite similar, in this case, we’re also notifying if the robot was found or not:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Http\Response</span><span class="p">;</span>

<span class="c1">// Retrieves robots based on primary key</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'/api/robots/{id:[0-9]+}'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>

    <span class="nv">$phql</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Robots WHERE id = :id:"</span><span class="p">;</span>
    <span class="nv">$robot</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">modelsManager</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="nv">$phql</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$id</span>
    <span class="p">))</span><span class="o">-&gt;</span><span class="na">getFirst</span><span class="p">();</span>

    <span class="c1">// Create a response</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$robot</span> <span class="o">==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setJsonContent</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="s1">'NOT-FOUND'</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setJsonContent</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="s1">'FOUND'</span><span class="p">,</span>
                <span class="s1">'data'</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'id'</span>   <span class="o">=&gt;</span> <span class="nv">$robot</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
                    <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$robot</span><span class="o">-&gt;</span><span class="na">name</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="inserting-data">
<h2>Inserting Data<a class="headerlink" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#inserting-data" title="Permalink to this headline">¶</a></h2>
<p>Taking the data as a JSON string inserted in the body of the request, we also use PHQL for insertion:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Http\Response</span><span class="p">;</span>

<span class="c1">// Adds a new robot</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">'/api/robots'</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>

    <span class="nv">$robot</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getJsonRawBody</span><span class="p">();</span>

    <span class="nv">$phql</span> <span class="o">=</span> <span class="s2">"INSERT INTO Robots (name, type, year) VALUES (:name:, :type:, :year:)"</span><span class="p">;</span>

    <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">modelsManager</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="nv">$phql</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$robot</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="nv">$robot</span><span class="o">-&gt;</span><span class="na">type</span><span class="p">,</span>
        <span class="s1">'year'</span> <span class="o">=&gt;</span> <span class="nv">$robot</span><span class="o">-&gt;</span><span class="na">year</span>
    <span class="p">));</span>

    <span class="c1">// Create a response</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">();</span>

    <span class="c1">// Check if the insertion was successful</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$status</span><span class="o">-&gt;</span><span class="na">success</span><span class="p">()</span> <span class="o">==</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Change the HTTP status</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setStatusCode</span><span class="p">(</span><span class="mi">201</span><span class="p">,</span> <span class="s2">"Created"</span><span class="p">);</span>

        <span class="nv">$robot</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="nv">$status</span><span class="o">-&gt;</span><span class="na">getModel</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setJsonContent</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="s1">'OK'</span><span class="p">,</span>
                <span class="s1">'data'</span>   <span class="o">=&gt;</span> <span class="nv">$robot</span>
            <span class="p">)</span>
        <span class="p">);</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="c1">// Change the HTTP status</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setStatusCode</span><span class="p">(</span><span class="mi">409</span><span class="p">,</span> <span class="s2">"Conflict"</span><span class="p">);</span>

        <span class="c1">// Send errors to the client</span>
        <span class="nv">$errors</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$status</span><span class="o">-&gt;</span><span class="na">getMessages</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$errors</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setJsonContent</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'status'</span>   <span class="o">=&gt;</span> <span class="s1">'ERROR'</span><span class="p">,</span>
                <span class="s1">'messages'</span> <span class="o">=&gt;</span> <span class="nv">$errors</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="updating-data">
<h2>Updating Data<a class="headerlink" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#updating-data" title="Permalink to this headline">¶</a></h2>
<p>The data update is similar to insertion. The “id” passed as parameter indicates what robot must be updated:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Http\Response</span><span class="p">;</span>

<span class="c1">// Updates robots based on primary key</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">'/api/robots/{id:[0-9]+}'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>

    <span class="nv">$robot</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getJsonRawBody</span><span class="p">();</span>

    <span class="nv">$phql</span> <span class="o">=</span> <span class="s2">"UPDATE Robots SET name = :name:, type = :type:, year = :year: WHERE id = :id:"</span><span class="p">;</span>
    <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">modelsManager</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="nv">$phql</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">,</span>
        <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$robot</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="nv">$robot</span><span class="o">-&gt;</span><span class="na">type</span><span class="p">,</span>
        <span class="s1">'year'</span> <span class="o">=&gt;</span> <span class="nv">$robot</span><span class="o">-&gt;</span><span class="na">year</span>
    <span class="p">));</span>

    <span class="c1">// Create a response</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">();</span>

    <span class="c1">// Check if the insertion was successful</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$status</span><span class="o">-&gt;</span><span class="na">success</span><span class="p">()</span> <span class="o">==</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setJsonContent</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="s1">'OK'</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="c1">// Change the HTTP status</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setStatusCode</span><span class="p">(</span><span class="mi">409</span><span class="p">,</span> <span class="s2">"Conflict"</span><span class="p">);</span>

        <span class="nv">$errors</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$status</span><span class="o">-&gt;</span><span class="na">getMessages</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$errors</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setJsonContent</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'status'</span>   <span class="o">=&gt;</span> <span class="s1">'ERROR'</span><span class="p">,</span>
                <span class="s1">'messages'</span> <span class="o">=&gt;</span> <span class="nv">$errors</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-data">
<h2>Deleting Data<a class="headerlink" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#deleting-data" title="Permalink to this headline">¶</a></h2>
<p>The data delete is similar to update. The “id” passed as parameter indicates what robot must be deleted:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Http\Response</span><span class="p">;</span>

<span class="c1">// Deletes robots based on primary key</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">'/api/robots/{id:[0-9]+}'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>

    <span class="nv">$phql</span> <span class="o">=</span> <span class="s2">"DELETE FROM Robots WHERE id = :id:"</span><span class="p">;</span>
    <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">modelsManager</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="nv">$phql</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$id</span>
    <span class="p">));</span>

    <span class="c1">// Create a response</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$status</span><span class="o">-&gt;</span><span class="na">success</span><span class="p">()</span> <span class="o">==</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setJsonContent</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="s1">'OK'</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="c1">// Change the HTTP status</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setStatusCode</span><span class="p">(</span><span class="mi">409</span><span class="p">,</span> <span class="s2">"Conflict"</span><span class="p">);</span>

        <span class="nv">$errors</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$status</span><span class="o">-&gt;</span><span class="na">getMessages</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$errors</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setJsonContent</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">'status'</span>   <span class="o">=&gt;</span> <span class="s1">'ERROR'</span><span class="p">,</span>
                <span class="s1">'messages'</span> <span class="o">=&gt;</span> <span class="nv">$errors</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-our-application">
<h2>Testing our Application<a class="headerlink" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#testing-our-application" title="Permalink to this headline">¶</a></h2>
<p>Using <a class="reference external" href="http://en.wikipedia.org/wiki/CURL">curl</a> we’ll test every route in our application verifying its proper operation:</p>
<p>Obtain all the robots:</p>
<div class="highlight-bash"><div class="highlight"><pre>curl -i -X GET http://localhost/my-rest-api/api/robots

HTTP/1.1 <span class="m">200</span> OK
Date: Tue, <span class="m">21</span> Jul <span class="m">2015</span> 07:05:13 GMT
Server: Apache/2.2.22 <span class="o">(</span>Unix<span class="o">)</span> DAV/2
Content-Length: 117
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8

<span class="o">[{</span><span class="s2">"id"</span>:<span class="s2">"1"</span>,<span class="s2">"name"</span>:<span class="s2">"Robotina"</span><span class="o">}</span>,<span class="o">{</span><span class="s2">"id"</span>:<span class="s2">"2"</span>,<span class="s2">"name"</span>:<span class="s2">"Astro Boy"</span><span class="o">}</span>,<span class="o">{</span><span class="s2">"id"</span>:<span class="s2">"3"</span>,<span class="s2">"name"</span>:<span class="s2">"Terminator"</span><span class="o">}]</span>
</pre></div>
</div>
<p>Search a robot by its name:</p>
<div class="highlight-bash"><div class="highlight"><pre>curl -i -X GET http://localhost/my-rest-api/api/robots/search/Astro

HTTP/1.1 <span class="m">200</span> OK
Date: Tue, <span class="m">21</span> Jul <span class="m">2015</span> 07:09:23 GMT
Server: Apache/2.2.22 <span class="o">(</span>Unix<span class="o">)</span> DAV/2
Content-Length: 31
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8

<span class="o">[{</span><span class="s2">"id"</span>:<span class="s2">"2"</span>,<span class="s2">"name"</span>:<span class="s2">"Astro Boy"</span><span class="o">}]</span>
</pre></div>
</div>
<p>Obtain a robot by its id:</p>
<div class="highlight-bash"><div class="highlight"><pre>curl -i -X GET http://localhost/my-rest-api/api/robots/3

HTTP/1.1 <span class="m">200</span> OK
Date: Tue, <span class="m">21</span> Jul <span class="m">2015</span> 07:12:18 GMT
Server: Apache/2.2.22 <span class="o">(</span>Unix<span class="o">)</span> DAV/2
Content-Length: 56
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8

<span class="o">{</span><span class="s2">"status"</span>:<span class="s2">"FOUND"</span>,<span class="s2">"data"</span>:<span class="o">{</span><span class="s2">"id"</span>:<span class="s2">"3"</span>,<span class="s2">"name"</span>:<span class="s2">"Terminator"</span><span class="o">}}</span>
</pre></div>
</div>
<p>Insert a new robot:</p>
<div class="highlight-bash"><div class="highlight"><pre>curl -i -X POST -d <span class="s1">'{"name":"C-3PO","type":"droid","year":1977}'</span>
    http://localhost/my-rest-api/api/robots

HTTP/1.1 <span class="m">201</span> Created
Date: Tue, <span class="m">21</span> Jul <span class="m">2015</span> 07:15:09 GMT
Server: Apache/2.2.22 <span class="o">(</span>Unix<span class="o">)</span> DAV/2
Content-Length: 75
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8

<span class="o">{</span><span class="s2">"status"</span>:<span class="s2">"OK"</span>,<span class="s2">"data"</span>:<span class="o">{</span><span class="s2">"name"</span>:<span class="s2">"C-3PO"</span>,<span class="s2">"type"</span>:<span class="s2">"droid"</span>,<span class="s2">"year"</span>:1977,<span class="s2">"id"</span>:<span class="s2">"4"</span><span class="o">}}</span>
</pre></div>
</div>
<p>Try to insert a new robot with the name of an existing robot:</p>
<div class="highlight-bash"><div class="highlight"><pre>curl -i -X POST -d <span class="s1">'{"name":"C-3PO","type":"droid","year":1977}'</span>
    http://localhost/my-rest-api/api/robots

HTTP/1.1 <span class="m">409</span> Conflict
Date: Tue, <span class="m">21</span> Jul <span class="m">2015</span> 07:18:28 GMT
Server: Apache/2.2.22 <span class="o">(</span>Unix<span class="o">)</span> DAV/2
Content-Length: 63
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8

<span class="o">{</span><span class="s2">"status"</span>:<span class="s2">"ERROR"</span>,<span class="s2">"messages"</span>:<span class="o">[</span><span class="s2">"The robot name must be unique"</span><span class="o">]}</span>
</pre></div>
</div>
<p>Or update a robot with an unknown type:</p>
<div class="highlight-bash"><div class="highlight"><pre>curl -i -X PUT -d <span class="s1">'{"name":"ASIMO","type":"humanoid","year":2000}'</span>
    http://localhost/my-rest-api/api/robots/4

HTTP/1.1 <span class="m">409</span> Conflict
Date: Tue, <span class="m">21</span> Jul <span class="m">2015</span> 08:48:01 GMT
Server: Apache/2.2.22 <span class="o">(</span>Unix<span class="o">)</span> DAV/2
Content-Length: 104
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8

<span class="o">{</span><span class="s2">"status"</span>:<span class="s2">"ERROR"</span>,<span class="s2">"messages"</span>:<span class="o">[</span><span class="s2">"Value of field 'type' must be part of</span>
<span class="s2">    list: droid, mechanical, virtual"</span><span class="o">]}</span>
</pre></div>
</div>
<p>Finally, delete a robot:</p>
<div class="highlight-bash"><div class="highlight"><pre>curl -i -X DELETE http://localhost/my-rest-api/api/robots/4

HTTP/1.1 <span class="m">200</span> OK
Date: Tue, <span class="m">21</span> Jul <span class="m">2015</span> 08:49:29 GMT
Server: Apache/2.2.22 <span class="o">(</span>Unix<span class="o">)</span> DAV/2
Content-Length: 15
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8

<span class="o">{</span><span class="s2">"status"</span>:<span class="s2">"OK"</span><span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="https://docs.phalconphp.com/en/latest/reference/tutorial-rest.html#conclusion" title="Permalink to this headline">¶</a></h2>
<p>As we have seen, develop a RESTful API with Phalcon is easy. Later in the documentation we’ll explain in detail how to
use micro applications and the <a class="reference internal" href="https://docs.phalconphp.com/en/latest/reference/phql.html"><em>PHQL</em></a> language.</p>
</div>
</div>


                    </div>
                  </div>
                </div>
            </div>
          </td>
        </tr>
      </tbody></table>
    <div class="related">
      <ul>
        <li class="right">
          <a href="https://docs.phalconphp.com/en/latest/genindex.html" title="General Index">index</a></li>
        <li class="right">
          <a href="https://docs.phalconphp.com/en/latest/reference/samples.html" title="List of examples">next</a> |</li>
        <li class="right">
          <a href="https://docs.phalconphp.com/en/latest/reference/tutorial-vokuro.html" title="Tutorial 6: Vökuró">previous</a> |</li> 
      </ul>
    </div>

      <div class="prefooter">
  <div class="container">
      <div class="row">
          <div class="col-sm-3 text-right">
              <span>Follow along:</span>
          </div>
          <div class="col-sm-6 text-center">
              <a href="https://twitter.com/phalconphp" alt="Twitter" class="btn-social btn-social-twitter"><i class="icon-twitter"></i></a>
              <a href="https://www.facebook.com/pages/Phalcon-Framework/134230726685897" alt="Facebook" class="btn-social btn-social-facebook"><i class="icon-facebook"></i></a>
              <a href="https://plus.google.com/102376109340560896457" alt="Google+" class="btn-social btn-social-googleplus"><i class="icon-googleplus"></i></a>
              <a href="https://github.com/phalcon/cphalcon" alt="Github" class="btn-social btn-social-github"><i class="icon-github"></i></a>
          </div>
          <div class="col-sm-3">
          </div>
      </div>
  </div>

</div>
<footer class="footer">
  <div class="container">
      <div class="row">
          <div class="col-xs-4 col-sm-3">
              <h4>Download</h4>
              <ul>
                  <li><a href="https://phalconphp.com/download">Installing Phalcon</a></li>
                  <li><a href="https://docs.phalconphp.com/en/latest/index.html" class="header-nav-link" target="_blank">Documentation</a></li>
                  <li><a href="https://api.phalconphp.com/">API</a></li>
                  <li><a href="https://docs.phalconphp.com/en/latest/reference/tutorial.html">Tutorial</a></li>
                  <li><a href="https://docs.phalconphp.com/en/latest/reference/tutorial.html#sample-applications">Sample Applications</a></li>
              </ul>
          </div>
          <div class="col-xs-4 col-sm-3">
              <h4>Community</h4>
              <ul>
                  <li><a href="https://forum.phalconphp.com/" class="header-nav-link" target="_blank">Forum</a></li>
                  <li><a href="https://github.com/phalcon/cphalcon">GitHub</a></li>
                  <li><a href="https://github.com/phalcon/cphalcon/issues">Issue Tracker</a></li>
                  <li><a href="http://stackoverflow.com/questions/tagged/phalcon">Stack Overflow</a></li>
                  <li><a href="https://phalconphp.com/en/testimonials">Testimonials</a></li>
                  <li><a href="https://builtwith.phalconphp.com/">Built with Phalcon</a></li>
                  <li><a href="http://store.phalconphp.com/">Store</a></li>
              </ul>
          </div>
          <div class="col-xs-4 col-sm-2">
              <h4>About</h4>
              <ul>
                  <li><a class="link-black" href="http://blog.phalconphp.com/">Blog</a></li>
                  <li><a href="https://phalconphp.com/en/about">About</a></li>
                  <li><a href="https://phalconphp.com/en/team">Team</a></li>
                  <li><a href="https://phalconphp.com/en/roadmap">Roadmap</a></li>
                  <li><a href="https://phalconphp.com/en/donate">Donate</a></li>
                  <li><a href="https://phalconphp.com/en/consulting">Consulting</a></li>
                  <li><a href="https://phalconphp.com/en/hosting">Hosting</a></li>
              </ul>
          </div>
          <div id="license-spaccer" class="visible-xs"></div>
          <div id="license-wrapper" class="col-xs-12 col-sm-4">
              <p class="license">

                  Found a typo or an error? Want to improve this document? The documentation sources are available on <a href="http://github.com/phalcon/docs">Github</a><br>
                  Need support or have questions? Check our <a href="http://forum.phalconphp.com/">Forum</a><br>
                  <br>

                  Phalcon Framework is released under the <a href="https://github.com/phalcon/cphalcon/blob/master/docs/LICENSE.md">new BSD license</a>.<br>
                  Except where otherwise noted, content on this site is licensed under the
                    <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License.</a>

                </p><div class="design">
                  <span>Designed by:</span>

                  <a href="http://www.fog-city.net/" class="fogcity" target="_blank" title="Fog City Software"><span>Fog City Software</span></a>
              </div>
          </div>
      </div>
  </div>
</footer>

    
    <script type="text/javascript">$(window).on("load",function(){var cx='009733439235723428699:lh9ltjgvdz8';var gcse=document.createElement('script');gcse.type='text/javascript';gcse.async=true;gcse.src=(document.location.protocol=='https:'?'https:':'http:')+'//www.google.com/cse/cse.js?cx='+cx;var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(gcse,s);});</script>

  
</body></html>